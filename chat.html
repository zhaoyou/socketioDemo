<!DOCTYPE html>
<html>
  <head>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
      #msg {
        color: #333
      }
      #onlinelist {
        position: relative;
        display: inline-block;
        width: 100px;
        height: 250px;
        border: solid 1px #ccc;
        vertical-align: top;
        margin-bottom: 20px;
      }
      #messageContainer {
        position: relative;
        display: inline-block;
        width: 400px;
        height: 250px;
        border: solid 1px #999;
      }

      #msg {
        margin-left: 100px;
      }
    </style>
    <script>
      $(function(){
        var socket = io.connect('http://localhost:8888');

        var userId = window.location.hash;
        // hash like '#userId', random like '0.12341122'
        userId =  (userId != '') ? userId.substr(1) : Math.random().toString().substr(2);

        socket.on("connect", function() {
          socket.emit('storeclient', {'userId': userId});
        });

        socket.on("message", function(message) {
          console.log(message);
          $('#messageContainer').append($('<p>' + message.sender +
                                          ' say: ' + message.msg+ '</p>'));
        });

        socket.on("disconnect", function() {
          $('#messageContainer').append($('<p>disconnected</p>'));
        });

        socket.on("onlineuser", function(list) {
          console.log("onlinelist ", list);
          $('#onlinelist').empty();
          list.forEach(function(user){
            $('#onlinelist').append($('<p>' + user.userId + '</p>'));
          });
        });

        $('#submitmsg').click(function() {
          var msg = $('#msg').val();
          socket.emit('message', {
            'to': 'all',
            'msg': msg
          });
          $('#messageContainer').append($('<p> self say: ' + msg + '</p>'));
        });
      });
    </script>
  </head>
  <body>

    <div id="onlinelist">
    </div>
    <div id="messageContainer">
    </div>
    <div></div>
    <textarea id="msg" name="msg"></textarea>
    <input id="submitmsg" type="button" value="Submit"/>
  </body>
<html>
